{% csrf_token %}
<script>


    
$(document).ready(function() {

    $("#createAdminBtn").click(function(e) {
        e.preventDefault()
        var adminForm = $("#adminForm");
        var adminList = $("#adminList");

        // Hide the client list when creating a new client
        adminList.hide();

        // Toggle the visibility of the client form
        adminForm.toggle();
    });



    // Move form submission event binding outside the click event handler
    $("#adminForm").submit(function(event) {
        console.log("BTN");
        var csrftoken = document.querySelector('[name=csrfmiddlewaretoken]').value;
        event.preventDefault(); // Prevent form submission
        

        var adminTableBody = document.querySelector("#adminTable tbody");
        var username = this.querySelector("input[type='text']").value;
        var password = this.querySelector("input[type='password']").value;

        console.log(username);

        var data = {

            'username':username,
            'password':password,
            'creating_admin': true
        }

        var formData =$(this).serialize();
        console.log(formData);

        $.ajax({
            type: "POST",
            url: "/users/",
            data: data,
            beforeSend: function(xhr, settings) {
                xhr.setRequestHeader("X-CSRFToken", csrftoken);
            },
            success: function(response) {
                // If login is successful, display success message
                console.log("success");
                $.confirm({
                            title: ``,
                            content:"Admin Added Successfully!",
                            type: "green",
                            typeAnimated: true,
                            columnClass: 'medium',
                            buttons: {
                            OK: {
                                text: "Close",
                                btnClass: "btn-blue",
                                action: function () {
                                    window.location.reload(); // Reload the page
                                }
                               
                                
                            },
                            },
                            
                        
                        });
                
                
                // You might want to reload the client list here or update it with the new client data
            },
            error: function(xhr, status, error) {
                // If login fails, display error message
                console.log("fail");

                $.confirm({
                            title:'',
                            content:'Email is already register!',
                            type:'red',
                            typeAnimated:true,
                            buttons:{
                                        tryAgain: {
                                            text: 'Try again',
                                            btnClass: 'btn-red',
                                            action: function () {
                                                window.location.reload(); // Reload the page
                                            }
                                            
                                        },
                                                    
                                    }

                        });


                
                console.log("fail",error);
               
            }
        });
    });


    
    
    $("#viewAdminListBtn").click(function() {
        var adminForm = $("#adminForm");
        var adminList = $("#adminList");
        var userType = "admin";
        
        // Hide the form when showing the client list
        adminForm.hide();

        // Perform a GET request to fetch client data
        $.ajax({
            type: "GET",
            url: "/users/", 
            data: { user_type: userType },// Replace this with your actual endpoint URL
            success: function(response) {
                // Assuming response is an array of client objects with properties like username, password, etc.
                // Clear any existing data in the client table body
                console.log(typeof response);
                $("#adminTable tbody").empty();
                var sequence = 1;
                // Iterate over each client object in the response and append it to the client table body
                response.forEach(function(admin) {
                    var row = $("<tr>");
                    row.append($("<td>").text(sequence++));
                    row.append($("<td>").text(admin.username));
                    row.append($("<td>").text(admin.password));
                    // Add more columns as needed
                    $("#adminTable tbody").append(row);
                });

                // Show the client list
                adminList.show();
            },
            error: function(xhr, status, error) {
                // Handle errors
                console.log("Error:", error);
            }
        });
    });

   



   
    
});


 
        



</script>
<style>
    
    .jconfirm .jconfirm-box.jconfirm-type-green 
    {
        border-top: solid 7px #1f0e3b !important;

    }
    .btn-blue
    {
        background-color:#1f0e3b !important;
        color: white;
    }
</style>